[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2025-01-11 23:13:32.671903",
  "module": "erpnextkta",
  "name": "KTA Sales Order Customization",
  "script": "frappe.ui.form.on('Sales Order', {\n//\trefresh(frm) {\n\t\t// your code here\n//\t}\n\tmake_manufacture_request: function(frm){\n\t    if((frm.doc.docstatus === 1 && doc.status !== \"Closed\" && doc.status !== \"On Hold\")){\n\t        // Call the server-side method to create the Material Request\n            frappe.call({\n                method: 'erpnextkta.api.make_manufacture_request',\n                args: {\n                    source_name: frm.doc.name\n                },\n                callback: function(r) {\n                    if (r.message) {\n                        frappe.set_route('Form', 'Material Request', r.message);\n                    }\n                }\n\t        });\n\t    }\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quality Feedback",
  "enabled": 1,
  "modified": "2025-01-06 23:12:47.353691",
  "module": "erpnextkta",
  "name": "KTA Degerlendirme Toplami",
  "script": "frappe.ui.form.on('Quality Feedback', {\n\tvalidate(frm) {\n        // calculate points for parameters on the feedback\n        degerlendirme_toplam = 0;\n        $.each(frm.doc.parameters,  function(i,  d) {\n            // calculate total\n            degerlendirme_toplam += flt(d.rating);\n        });\n        frm.doc.degerlendirme_toplami = degerlendirme_toplam;\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Customer",
  "enabled": 1,
  "modified": "2025-01-09 17:41:35.114236",
  "module": "erpnextkta",
  "name": "KTA Müşteri Gelir Hesabı",
  "script": "frappe.ui.form.on('Customer', {\n\tsetup(frm) {\n\t\tfrm.set_query(\"customer_income_account\", \"accounts\", function (doc, cdt, cdn) {\n\t\t\tlet d = locals[cdt][cdn];\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\taccount_type: \"Income Account\",\n\t\t\t\t\troot_type: \"Income\",\n\t\t\t\t\tcompany: d.company,\n\t\t\t\t\tis_group: 0,\n\t\t\t\t},\n\t\t\t};\n\t\t});\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2025-01-11 06:09:25.924044",
  "module": "erpnextkta",
  "name": "KTA Müşteri Gelir Hesabı Ataması",
  "script": "frappe.ui.form.on('Sales Invoice', {\r\n    onload: function(frm) {\r\n        // Populate income account for all items when the form is loaded\r\n        frm.doc.items.forEach(function(item) {\r\n            if (item.item_code && frm.doc.company && frm.doc.customer) {\r\n                fetch_customer_income_account(frm, item);\r\n            }\r\n        });\r\n    },\r\n    refresh: function(frm) {\r\n        // Populate income account for all items when the form is refreshed\r\n        frm.doc.items.forEach(function(item) {\r\n            if (item.item_code && frm.doc.company && frm.doc.customer) {\r\n                fetch_customer_income_account(frm, item);\r\n            }\r\n        });\r\n    }\r\n});\r\n\r\nfrappe.ui.form.on('Sales Invoice Item', {\r\n    item_code: function(frm, cdt, cdn) {\r\n        let item = frappe.get_doc(cdt, cdn);\r\n        if (item.item_code && frm.doc.company && frm.doc.customer) {\r\n            frappe.call({\r\n                method: 'erpnextkta.api.get_customer_income_account', // Updated method path\r\n                args: {\r\n                    'customer': frm.doc.customer,\r\n                    'company': frm.doc.company\r\n                },\r\n                callback: function(r) {\r\n                    if (r.message) {\r\n                        frappe.model.set_value(cdt, cdn, 'income_account', r.message);\r\n                    } else {\r\n                        frappe.msgprint(__(\"No customer income account found for the selected customer and company.\"));\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n});\r\n\r\nfunction fetch_customer_income_account(frm, item) {\r\n    frappe.call({\r\n        method: 'erpnextkta.api.get_customer_income_account', // Updated method path\r\n        args: {\r\n            'customer': frm.doc.customer,\r\n            'company': frm.doc.company\r\n        },\r\n        callback: function(r) {\r\n            if (r.message) {\r\n                frappe.model.set_value(item.doctype, item.name, 'income_account', r.message);\r\n            } else {\r\n                frappe.msgprint(__(\"No customer income account found for the selected customer and company.\"));\r\n            }\r\n        }\r\n    });\r\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Job Card",
  "enabled": 1,
  "modified": "2025-01-23 01:46:54.882008",
  "module": "erpnextkta",
  "name": "KTA Job Card employee ignore_user_permissions",
  "script": "frappe.ui.form.on('Job Card', {\n    refresh: function(frm) {\n        // Set \"Ignore User Permissions\" for the field\n        frm.set_df_property('employee', 'ignore_user_permissions', 1);\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Kalite 8D Formu",
  "enabled": 1,
  "modified": "2025-01-23 02:07:31.420310",
  "module": "erpnextkta",
  "name": "KTA Kalite 8D Formu d1_takim_uyesi",
  "script": "frappe.ui.form.on('D1 Takim Uyeleri', {\n    refresh: function(frm) {\n        // Set \"Ignore User Permissions\" for the field in the child table\n        frm.set_df_property('d1_takim_uyesi', 'ignore_user_permissions', 1);\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Work Order",
  "enabled": 1,
  "modified": "2025-05-28 13:44:47.910100",
  "module": "erpnextkta",
  "name": "KTA Kesim Formu Butonu",
  "script": "frappe.ui.form.on('Work Order', {\n    refresh: function(frm) {\n        if (frm.doc.custom_kesim_formu_link) {\n            frm.add_custom_button('Kesim Formunu Aç', function () {\n                window.open(frm.doc.custom_kesim_formu_link, '_blank');\n            }, 'View');  // View altına geldi\n        }\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Project",
  "enabled": 1,
  "modified": "2025-05-28 13:45:11.599923",
  "module": "erpnextkta",
  "name": "KTA Proje Klasörü",
  "script": "frappe.ui.form.on('Project', {\n    refresh(frm) {\n        if (frm.doc.project_name) {\n            const folderName = encodeURIComponent(frm.doc.project_name);\n            const path = `/app/file?folder=Home/Projeler/${folderName}`;\n            \n            frm.add_custom_button(__('Proje Klasörü'), function () {\n                window.open(path, '_blank');\n            });\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item Price",
  "enabled": 1,
  "modified": "2025-05-28 13:45:34.251458",
  "module": "erpnextkta",
  "name": "KTA Ara Malzeme Grubu",
  "script": "frappe.ui.form.on(\"Item Price\", {\n    item_code: function(frm) {\n        if (frm.doc.item_code) {\n            frappe.call({\n                method: \"frappe.client.get_value\",\n                args: {\n                    doctype: \"Item\",\n                    filters: {\n                        name: frm.doc.item_code\n                    },\n                    fieldname: [\"custom_ara_malzeme_grubu\"]\n                },\n                callback: function(r) {\n                    if (r.message && r.message.custom_ara_malzeme_grubu) {\n                        frm.set_value(\"custom_ara_malzeme_kodu\", r.message.custom_ara_malzeme_grubu);\n                        console.log(\"Ara malzeme grubu güncellendi:\", r.message.custom_ara_malzeme_grubu);\n                    } else {\n                        frm.set_value(\"custom_ara_malzeme_kodu\", \"\");\n                        console.warn(\"Ürün bulundu ama 'custom_ara_malzeme_grubu' boş.\");\n                    }\n                }\n            });\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Work Order",
  "enabled": 1,
  "modified": "2025-05-28 13:45:53.648264",
  "module": "erpnextkta",
  "name": "KTA Work Order Material Group",
  "script": "frappe.ui.form.on('Work Order', {\n    refresh: function(frm) {\n        // Sadece taslak durumda ve kapatılmamış belgelerde çalıştır\n        if (\n            frm.doc.docstatus === 0 &&\n            frm.doc.production_item &&\n            !frm.doc.__islocal &&\n            frm.doc.status !== \"Closed\"\n        ) {\n            set_item_group(frm);\n        }\n    },\n    production_item: function(frm) {\n        // Ürün değiştiğinde sadece taslak ve kapatılmamış belgelerde çalıştır\n        if (frm.doc.docstatus === 0 && frm.doc.status !== \"Closed\") {\n            set_item_group(frm);\n        }\n    },\n    onload: function(frm) {\n        frm.set_df_property('custom_ürün_grubu', 'read_only', 1);\n    }\n});\n\n// Yardımcı fonksiyon\nfunction set_item_group(frm) {\n    if (frm.doc.production_item) {\n        frappe.db.get_value(\"Item\", frm.doc.production_item, \"item_group\")\n            .then(r => {\n                if (r.message && r.message.item_group) {\n                    frm.set_value(\"custom_ürün_grubu\", r.message.item_group);\n                }\n            });\n    }\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "KTA Depo Etiketleri",
  "enabled": 1,
  "modified": "2025-07-09 08:54:44.602618",
  "module": "erpnextkta",
  "name": "KTA Depo Etiketi Bas",
  "script": "frappe.ui.form.on('KTA Depo Etiketleri', {\n// refresh(frm) {\n    print_label_to_zebra_kta: function(frm){\n        frappe.call({\n                    method: \"erpnextkta.api.print_kta_pr_labels\",\n                    args:{\n                        \"label\": frm.doc.name\n                    },\n                    callback: function(r){\n                        frm.set_value(\"custom_print_status\", r.message);\n                    }\n                });\n    },\n    print_split_labels_to_zebra_kta: function(frm){\n        frappe.call({\n                    method: \"erpnextkta.api.print_split_kta_pr_labels\",\n                    args:{\n                        \"label\": frm.doc.name\n                    },\n                    callback: function(r){\n                        frm.set_value(\"custom_print_status\", r.message);\n                    }\n                });\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "KTA machine capability study",
  "enabled": 1,
  "modified": "2025-07-14 23:32:55.367851",
  "module": "erpnextkta",
  "name": "KTA Kalite CMK CM CPK",
  "script": "frappe.ui.form.on('KTA machine capability study', {\r\n    validate: function(frm) {\r\n        const ROUNDING_DECIMALS = 6;\r\n        const upperLimit = frm.doc.upper_limit;\r\n        const lowerLimit = frm.doc.lower_limit;\r\n        if (upperLimit <= lowerLimit) {\r\n            frappe.msgprint(__('Üst limit alt limitten büyük olmalıdır'));\r\n            return;\r\n        }\r\n        const STANDARD_DIVISOR = 7.67; // 6 + 1.67\r\n        const nominalValue = frm.doc.nominal_value;\r\n        const sollCmk = frm.doc.soll_cmk;\r\n        const toleranzBreite = upperLimit - lowerLimit;\r\n        const sollStandard = toleranzBreite / STANDARD_DIVISOR;\r\n        if (frm.doc.veri_tablosu && frm.doc.veri_tablosu.length > 0) {\r\n            const MEASUREMENTS_PER_GROUP = 5;\r\n            let xa = [];\r\n            let subXa = [];\r\n            let xq = [];\r\n            let si = [];\r\n            let sumOfXa = 0;\r\n            let sumOfSubXa = 0;\r\n            let sumOfSi = 0;\r\n            let maxOfXa = null;\r\n            let minOfXa = null;\r\n            let maxOfXq = null;\r\n            let minOfXq = null;\r\n            frm.doc.veri_tablosu.forEach(function(d) {\r\n                const veri = flt(d.veri);\r\n                if (!isNaN(veri) && veri !== 0) {\r\n                    if (veri < lowerLimit || veri > upperLimit) {\r\n                        frappe.model.set_value(d.doctype, d.name, 'out_of_spec', true);\r\n                    } else {\r\n                        xa.push(veri);\r\n                        sumOfXa += veri;\r\n                        if (minOfXa === null || veri < minOfXa) {\r\n                            minOfXa = veri;\r\n                        }\r\n                        if (maxOfXa === null || veri > maxOfXa) {\r\n                            maxOfXa = veri;\r\n                        }\r\n                        subXa.push(veri);\r\n                        sumOfSubXa += veri;\r\n                        frappe.model.set_value(d.doctype, d.name, 'out_of_spec', false);\r\n                    }\r\n                }\r\n                if (d.idx % MEASUREMENTS_PER_GROUP === 0 && sumOfSubXa !== 0) {\r\n                    const meanOfSubXa = sumOfSubXa / subXa.length;\r\n                    xq.push(meanOfSubXa);\r\n                    if (minOfXq === null || meanOfSubXa < minOfXq) {\r\n                        minOfXq = meanOfSubXa;\r\n                    }\r\n                    if (maxOfXq === null || meanOfSubXa > maxOfXq) {\r\n                        maxOfXq = meanOfSubXa;\r\n                    }\r\n                    frappe.model.set_value(d.doctype, d.name, 'ara_olcum_ortalamasi', flt(meanOfSubXa).toFixed(ROUNDING_DECIMALS));\r\n                    let sumOfSubXaDevSquared = 0;\r\n                    for (let i = 0; i < subXa.length; i++) {\r\n                        const subXaDev = subXa[i] - meanOfSubXa;\r\n                        sumOfSubXaDevSquared += subXaDev * subXaDev;\r\n                    }\r\n                    let stdDevOfSubXa = 0;\r\n                    if (subXa.length > 1) {\r\n                        stdDevOfSubXa = Math.sqrt(sumOfSubXaDevSquared / (subXa.length - 1));\r\n                    }\r\n                    si.push(stdDevOfSubXa);\r\n                    sumOfSi += stdDevOfSubXa;\r\n                    frappe.model.set_value(d.doctype, d.name, 'ara_olcum_std_sapmasi', flt(stdDevOfSubXa).toFixed(ROUNDING_DECIMALS));\r\n                    subXa = [];\r\n                    sumOfSubXa = 0;\r\n                }\r\n            });\r\n        }\r\n        if (maxOfXa === null) {\r\n            frm.set_value('tepe_deger', 0);\r\n        } else {\r\n            frm.set_value('tepe_deger', maxOfXa);\r\n        }\r\n        if (minOfXa === null) {\r\n            frm.set_value('dip_deger', 0);\r\n        } else {\r\n            frm.set_value('dip_deger', minOfXa);\r\n        }\r\n        if (maxOfXq === null) {\r\n            frm.set_value('tepe_degerixq', 0);\r\n        } else {\r\n            frm.set_value('tepe_degerixq', maxOfXq);\r\n        }\r\n        if (minOfXq === null) {\r\n            frm.set_value('dip_degerixq', 0);\r\n        } else {\r\n            frm.set_value('dip_degerixq', minOfXq);\r\n        }\r\n        let meanValue = 0;\r\n        if (xa.length > 0) {\r\n            meanValue = sumOfXa / xa.length;\r\n        }\r\n        let sumOfXaDevSquared = 0;\r\n        for (let i = 0; i < xa.length; i++) {\r\n            const xaDev = xa[i] - meanValue;\r\n            sumOfXaDevSquared += xaDev * xaDev;\r\n        }\r\n        let stdDevXa = 0;\r\n        if (xa.length > 1) {\r\n            stdDevXa = Math.sqrt(sumOfXaDevSquared / (xa.length - 1));\r\n        }\r\n        const capLabel = \"capable\";\r\n        const incapLabel = \"incapable\";\r\n        const cm = toleranzBreite / (6 * stdDevXa);\r\n        const cmkUn = (minOfXa - lowerLimit) / (3 * stdDevXa);\r\n        const cmkOb = (upperLimit - maxOfXa) / (3 * stdDevXa);\r\n        frm.set_value('mean_value', flt(meanValue).toFixed(ROUNDING_DECIMALS));\r\n        frm.set_value('standard_deviation', flt(stdDevXa).toFixed(ROUNDING_DECIMALS));\r\n        frm.set_value('cm_value', flt(cm).toFixed(ROUNDING_DECIMALS));\r\n        if (cm > sollCmk) {\r\n            frm.set_value('cm_capable', capLabel);\r\n        } else {\r\n            frm.set_value('cm_capable', incapLabel);\r\n        }\r\n        let cmk = 0;\r\n        if (cmkOb > cmkUn) {\r\n            cmk = cmkUn;\r\n        } else {\r\n            cmk = cmkOb;\r\n        }\r\n        frm.set_value('cmk_value', flt(cmk).toFixed(ROUNDING_DECIMALS));\r\n        if (cmk > sollCmk) {\r\n            frm.set_value('cmk_capable', capLabel);\r\n        } else {\r\n            frm.set_value('cmk_capable', incapLabel);\r\n        }\r\n        let meanSi = 0;\r\n        if (si.length > 0) {\r\n            meanSi = sumOfSi / si.length;\r\n        }\r\n        let stdDevXq = 0;\r\n        if (meanSi === 0) {\r\n            stdDevXq = sollStandard;\r\n        } else {\r\n            stdDevXq = meanSi;\r\n        }\r\n        const CONFIDENCE_FACTOR = 2.58; // 99% confidence\r\n        const D2_CORRECTION = 0.94; // For subgroup size 5\r\n        const SQRT5 = Math.sqrt(5);\r\n        // const cmq = toleranzBreite / (6 * stdDevXq);\r\n        const cmkOben = (upperLimit - meanValue) / (3 * stdDevXq);\r\n        const cmkUnten = (meanValue - lowerLimit) / (3 * stdDevXq);\r\n        const oeg = meanValue + (CONFIDENCE_FACTOR / SQRT5) * (meanSi / D2_CORRECTION);\r\n        const ueg = meanValue - (CONFIDENCE_FACTOR / SQRT5) * (meanSi / D2_CORRECTION);\r\n        frm.set_value('cmk_performance_oeg', oeg);\r\n        frm.set_value('cmk_performance_ueg', ueg);\r\n        frm.set_value('xq_deviation', flt(Math.abs(nominalValue - meanValue)).toFixed(ROUNDING_DECIMALS));\r\n\r\n    }\r\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Work Order",
  "enabled": 1,
  "modified": "2025-07-09 16:47:46.492990",
  "module": "erpnextkta",
  "name": "KTA Ürün Tanıtım Etiketi Bas",
  "script": "frappe.ui.form.on('Work Order', {\n\tcustom_etiket_bas: function(frm){\n        frappe.call({\n                    method: \"erpnextkta.api.print_kta_wo_labels\",\n                    args:{\n                        \"work_order\": frm.doc.name\n                    }\n                });\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Entry",
  "enabled": 1,
  "modified": "2025-07-11 16:29:16.305841",
  "module": "erpnextkta",
  "name": "KTA Hareketten Ürün Tanıtım Etiketi Bas",
  "script": "frappe.ui.form.on('Stock Entry', {\n\tcustom_etiket_bas: function(frm){\n        frappe.call({\n                    method: \"erpnextkta.api.print_kta_wo_labels_of_stock_entry\",\n                    args:{\n                        \"stock_entry\": frm.doc.name\n                    }\n                });\n    }\n});",
  "view": "Form"
 }
]