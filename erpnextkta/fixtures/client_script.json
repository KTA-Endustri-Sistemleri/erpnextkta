[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "KTA Mobil Depo",
  "enabled": 1,
  "modified": "2025-07-15 18:11:25.711846",
  "module": "erpnextkta",
  "name": "KTA Mobil Depo Yonetimi",
  "script": "frappe.ui.form.on('KTA Mobil Depo', {\n\trefresh(frm) {\n        frappe.call({\n            method: \"erpnextkta.api.find_bins_of_sut\",\n            args:{\n                \"sut\": frm.doc.sut_barcode\n            }\n        });\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2025-01-11 23:13:32.671903",
  "module": "erpnextkta",
  "name": "KTA Sales Order Customization",
  "script": "frappe.ui.form.on('Sales Order', {\n//\trefresh(frm) {\n\t\t// your code here\n//\t}\n\tmake_manufacture_request: function(frm){\n\t    if((frm.doc.docstatus === 1 && doc.status !== \"Closed\" && doc.status !== \"On Hold\")){\n\t        // Call the server-side method to create the Material Request\n            frappe.call({\n                method: 'erpnextkta.api.make_manufacture_request',\n                args: {\n                    source_name: frm.doc.name\n                },\n                callback: function(r) {\n                    if (r.message) {\n                        frappe.set_route('Form', 'Material Request', r.message);\n                    }\n                }\n\t        });\n\t    }\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quality Feedback",
  "enabled": 1,
  "modified": "2025-01-06 23:12:47.353691",
  "module": "erpnextkta",
  "name": "KTA Degerlendirme Toplami",
  "script": "frappe.ui.form.on('Quality Feedback', {\n\tvalidate(frm) {\n        // calculate points for parameters on the feedback\n        degerlendirme_toplam = 0;\n        $.each(frm.doc.parameters,  function(i,  d) {\n            // calculate total\n            degerlendirme_toplam += flt(d.rating);\n        });\n        frm.doc.degerlendirme_toplami = degerlendirme_toplam;\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Customer",
  "enabled": 1,
  "modified": "2025-01-09 17:41:35.114236",
  "module": "erpnextkta",
  "name": "KTA Müşteri Gelir Hesabı",
  "script": "frappe.ui.form.on('Customer', {\n\tsetup(frm) {\n\t\tfrm.set_query(\"customer_income_account\", \"accounts\", function (doc, cdt, cdn) {\n\t\t\tlet d = locals[cdt][cdn];\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\taccount_type: \"Income Account\",\n\t\t\t\t\troot_type: \"Income\",\n\t\t\t\t\tcompany: d.company,\n\t\t\t\t\tis_group: 0,\n\t\t\t\t},\n\t\t\t};\n\t\t});\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2025-01-11 06:09:25.924044",
  "module": "erpnextkta",
  "name": "KTA Müşteri Gelir Hesabı Ataması",
  "script": "frappe.ui.form.on('Sales Invoice', {\r\n    onload: function(frm) {\r\n        // Populate income account for all items when the form is loaded\r\n        frm.doc.items.forEach(function(item) {\r\n            if (item.item_code && frm.doc.company && frm.doc.customer) {\r\n                fetch_customer_income_account(frm, item);\r\n            }\r\n        });\r\n    },\r\n    refresh: function(frm) {\r\n        // Populate income account for all items when the form is refreshed\r\n        frm.doc.items.forEach(function(item) {\r\n            if (item.item_code && frm.doc.company && frm.doc.customer) {\r\n                fetch_customer_income_account(frm, item);\r\n            }\r\n        });\r\n    }\r\n});\r\n\r\nfrappe.ui.form.on('Sales Invoice Item', {\r\n    item_code: function(frm, cdt, cdn) {\r\n        let item = frappe.get_doc(cdt, cdn);\r\n        if (item.item_code && frm.doc.company && frm.doc.customer) {\r\n            frappe.call({\r\n                method: 'erpnextkta.api.get_customer_income_account', // Updated method path\r\n                args: {\r\n                    'customer': frm.doc.customer,\r\n                    'company': frm.doc.company\r\n                },\r\n                callback: function(r) {\r\n                    if (r.message) {\r\n                        frappe.model.set_value(cdt, cdn, 'income_account', r.message);\r\n                    } else {\r\n                        frappe.msgprint(__(\"No customer income account found for the selected customer and company.\"));\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n});\r\n\r\nfunction fetch_customer_income_account(frm, item) {\r\n    frappe.call({\r\n        method: 'erpnextkta.api.get_customer_income_account', // Updated method path\r\n        args: {\r\n            'customer': frm.doc.customer,\r\n            'company': frm.doc.company\r\n        },\r\n        callback: function(r) {\r\n            if (r.message) {\r\n                frappe.model.set_value(item.doctype, item.name, 'income_account', r.message);\r\n            } else {\r\n                frappe.msgprint(__(\"No customer income account found for the selected customer and company.\"));\r\n            }\r\n        }\r\n    });\r\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Job Card",
  "enabled": 1,
  "modified": "2025-01-23 01:46:54.882008",
  "module": "erpnextkta",
  "name": "KTA Job Card employee ignore_user_permissions",
  "script": "frappe.ui.form.on('Job Card', {\n    refresh: function(frm) {\n        // Set \"Ignore User Permissions\" for the field\n        frm.set_df_property('employee', 'ignore_user_permissions', 1);\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Kalite 8D Formu",
  "enabled": 1,
  "modified": "2025-01-23 02:07:31.420310",
  "module": "erpnextkta",
  "name": "KTA Kalite 8D Formu d1_takim_uyesi",
  "script": "frappe.ui.form.on('D1 Takim Uyeleri', {\n    refresh: function(frm) {\n        // Set \"Ignore User Permissions\" for the field in the child table\n        frm.set_df_property('d1_takim_uyesi', 'ignore_user_permissions', 1);\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Project",
  "enabled": 1,
  "modified": "2025-05-28 13:45:11.599923",
  "module": "erpnextkta",
  "name": "KTA Proje Klasörü",
  "script": "frappe.ui.form.on('Project', {\n    refresh(frm) {\n        if (frm.doc.project_name) {\n            const folderName = encodeURIComponent(frm.doc.project_name);\n            const path = `/app/file?folder=Home/Projeler/${folderName}`;\n            \n            frm.add_custom_button(__('Proje Klasörü'), function () {\n                window.open(path, '_blank');\n            });\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item Price",
  "enabled": 1,
  "modified": "2025-05-28 13:45:34.251458",
  "module": "erpnextkta",
  "name": "KTA Ara Malzeme Grubu",
  "script": "frappe.ui.form.on(\"Item Price\", {\n    item_code: function(frm) {\n        if (frm.doc.item_code) {\n            frappe.call({\n                method: \"frappe.client.get_value\",\n                args: {\n                    doctype: \"Item\",\n                    filters: {\n                        name: frm.doc.item_code\n                    },\n                    fieldname: [\"custom_ara_malzeme_grubu\"]\n                },\n                callback: function(r) {\n                    if (r.message && r.message.custom_ara_malzeme_grubu) {\n                        frm.set_value(\"custom_ara_malzeme_kodu\", r.message.custom_ara_malzeme_grubu);\n                        console.log(\"Ara malzeme grubu güncellendi:\", r.message.custom_ara_malzeme_grubu);\n                    } else {\n                        frm.set_value(\"custom_ara_malzeme_kodu\", \"\");\n                        console.warn(\"Ürün bulundu ama 'custom_ara_malzeme_grubu' boş.\");\n                    }\n                }\n            });\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "KTA Depo Etiketleri",
  "enabled": 1,
  "modified": "2025-07-09 08:54:44.602618",
  "module": "erpnextkta",
  "name": "KTA Depo Etiketi Bas",
  "script": "frappe.ui.form.on('KTA Depo Etiketleri', {\n// refresh(frm) {\n    print_label_to_zebra_kta: function(frm){\n        frappe.call({\n                    method: \"erpnextkta.api.print_kta_pr_labels\",\n                    args:{\n                        \"label\": frm.doc.name\n                    },\n                    callback: function(r){\n                        frm.set_value(\"custom_print_status\", r.message);\n                    }\n                });\n    },\n    print_split_labels_to_zebra_kta: function(frm){\n        frappe.call({\n                    method: \"erpnextkta.api.print_split_kta_pr_labels\",\n                    args:{\n                        \"label\": frm.doc.name\n                    },\n                    callback: function(r){\n                        frm.set_value(\"custom_print_status\", r.message);\n                    }\n                });\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "KTA machine capability study",
  "enabled": 1,
  "modified": "2025-07-16 16:58:02.329929",
  "module": "erpnextkta",
  "name": "KTA Kalite CMK CM CPK",
  "script": "frappe.ui.form.on('KTA machine capability study', {\n    validate: function(frm) {\n        const ROUNDING_DECIMALS = 6;\n        const upperLimit = frm.doc.upper_limit;\n        const lowerLimit = frm.doc.lower_limit;\n        const MEASUREMENTS_PER_GROUP = 5;\n        var xa = [];\n        var subXa = [];\n        var xq = [];\n        var si = [];\n        var sumOfXa = 0;\n        var sumOfSubXa = 0;\n        var sumOfSi = 0;\n        var maxOfXa = 0;\n        var minOfXa = 0;\n        var maxOfXq = 0;\n        var minOfXq = 0;\n        // 6 + 1.67\n        const STANDARD_DIVISOR = 7.67;\n        const nominalValue = frm.doc.nominal_value;\n        const sollCmk = frm.doc.soll_cmk;\n        const toleranzBreite = upperLimit - lowerLimit;\n        const sollStandard = toleranzBreite / STANDARD_DIVISOR;\n        if (upperLimit <= lowerLimit) {\n            frappe.msgprint(__('Üst limit alt limitten büyük olmalıdır'));\n            return;\n        }\n        if (frm.doc.veri_tablosu && frm.doc.veri_tablosu.length > 0) {\n            frm.doc.veri_tablosu.forEach(function(d) {\n                const veri = flt(d.veri);\n                if (!isNaN(veri) && veri !== 0) {\n                    if (veri < lowerLimit || veri > upperLimit) {\n                        frappe.model.set_value(d.doctype, d.name, 'out_of_spec', true);\n                    } else {\n                        xa.push(veri);\n                        sumOfXa += veri;\n                        if (minOfXa === 0 || veri < minOfXa) {\n                            minOfXa = veri;\n                        }\n                        if (maxOfXa === 0 || veri > maxOfXa) {\n                            maxOfXa = veri;\n                        }\n                        subXa.push(veri);\n                        sumOfSubXa += veri;\n                        frappe.model.set_value(d.doctype, d.name, 'out_of_spec', false);\n                    }\n                }\n                if (d.idx % MEASUREMENTS_PER_GROUP === 0 && sumOfSubXa !== 0) {\n                    const meanOfSubXa = sumOfSubXa / subXa.length;\n                    xq.push(meanOfSubXa);\n                    if (minOfXq === 0 || meanOfSubXa < minOfXq) {\n                        minOfXq = meanOfSubXa;\n                    }\n                    if (maxOfXq === 0 || meanOfSubXa > maxOfXq) {\n                        maxOfXq = meanOfSubXa;\n                    }\n                    frappe.model.set_value(d.doctype, d.name, 'ara_olcum_ortalamasi', flt(meanOfSubXa).toFixed(ROUNDING_DECIMALS));\n                    var sumOfSubXaDevSquared = 0;\n                    for (let i = 0; i < subXa.length; i++) {\n                        const subXaDev = subXa[i] - meanOfSubXa;\n                        sumOfSubXaDevSquared += subXaDev * subXaDev;\n                    }\n                    var stdDevOfSubXa = 0;\n                    if (subXa.length > 1) {\n                        stdDevOfSubXa = Math.sqrt(sumOfSubXaDevSquared / (subXa.length - 1));\n                    }\n                    si.push(stdDevOfSubXa);\n                    sumOfSi += stdDevOfSubXa;\n                    frappe.model.set_value(d.doctype, d.name, 'ara_olcum_std_sapmasi', flt(stdDevOfSubXa).toFixed(ROUNDING_DECIMALS));\n                    subXa = [];\n                    sumOfSubXa = 0;\n                }\n            });\n        }\n        frm.set_value('tepe_deger', maxOfXa);\n        frm.set_value('dip_deger', minOfXa);\n        var meanValue = 0;\n        if (xa.length > 0) {\n            meanValue = sumOfXa / xa.length;\n        }\n        var sumOfXaDevSquared = 0;\n        for (let i = 0; i < xa.length; i++) {\n            const xaDev = xa[i] - meanValue;\n            sumOfXaDevSquared += xaDev * xaDev;\n        }\n        var stdDevXa = 0;\n        if (xa.length > 1) {\n            stdDevXa = Math.sqrt(sumOfXaDevSquared / (xa.length - 1));\n        }\n        const capLabel = \"capable\";\n        const incapLabel = \"incapable\";\n        const cm = toleranzBreite / (6 * stdDevXa);\n        frm.set_value('mean_value', flt(meanValue).toFixed(ROUNDING_DECIMALS));\n        frm.set_value('standard_deviation', flt(stdDevXa).toFixed(ROUNDING_DECIMALS));\n        frm.set_value('cm_value', flt(cm).toFixed(ROUNDING_DECIMALS));\n        if (cm > sollCmk) {\n            frm.set_value('cm_capable', capLabel);\n        } else {\n            frm.set_value('cm_capable', incapLabel);\n        }\n        var meanSi = 0;\n        if (si.length > 0) {\n            meanSi = sumOfSi / si.length;\n        }\n        var stdDevXq = 0;\n        if (meanSi === 0) {\n            stdDevXq = sollStandard;\n        } else {\n            stdDevXq = meanSi;\n        }\n        frm.set_value('tepe_degerixq', maxOfXq);\n        frm.set_value('dip_degerixq', minOfXq);\n        // 99% confidence\n        const CONFIDENCE_FACTOR = 2.58;\n        // For subgroup size 5\n        const D2_CORRECTION = 0.94;\n        // const cmq = toleranzBreite / (6 * stdDevXq);\n        const SQRT5 = Math.sqrt(5);\n        const cmkOben = (upperLimit - maxOfXq) / (3 * stdDevXa);\n        const cmkUnten = (minOfXq - lowerLimit) / (3 * stdDevXa);\n        const oeg = meanValue + (CONFIDENCE_FACTOR / SQRT5) * (meanSi / D2_CORRECTION);\n        const ueg = meanValue - (CONFIDENCE_FACTOR / SQRT5) * (meanSi / D2_CORRECTION);\n        var cmk = 0;\n        if (cmkOben > cmkUnten) {\n            cmk = cmkUnten;\n        } else {\n            cmk = cmkOben;\n        }\n        frm.set_value('cmk_value', flt(cmk).toFixed(ROUNDING_DECIMALS));\n        if (cmk > sollCmk) {\n            frm.set_value('cmk_capable', capLabel);\n        } else {\n            frm.set_value('cmk_capable', incapLabel);\n        }\n        frm.set_value('cmk_performance_oeg', oeg);\n        frm.set_value('cmk_performance_ueg', ueg);\n        frm.set_value('xq_deviation', flt(Math.abs(nominalValue - meanValue)).toFixed(ROUNDING_DECIMALS));\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Entry",
  "enabled": 1,
  "modified": "2025-07-15 19:07:25.437961",
  "module": "erpnextkta",
  "name": "KTA Hareketten Ürün Tanıtım Etiketi Bas",
  "script": "frappe.ui.form.on('Stock Entry', {\n\tcustom_etiket_bas: function(frm){\n        frappe.call({\n            method: \"erpnextkta.api.print_kta_wo_labels_of_stock_entry\",\n            args:{\n                \"stock_entry\": frm.doc.name\n            }\n        });\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "KTA Mobil Depo",
  "enabled": 1,
  "modified": "2025-07-16 10:19:22.411776",
  "module": "erpnextkta",
  "name": "KTA Mobil Depo Uygulamaları",
  "script": "frappe.ui.form.on('KTA Mobil Depo', {\n\tsut_ara: function(frm){\n        frappe.call({\n            method: \"erpnextkta.api.find_bins_of_sut\",\n            args:{\n                \"sut\": frm.doc.sut_barcode,\n                \"mobil\": frm.doc.name\n            },\n            callback: function(response) {\n            // handle response\n                frm.refresh;\n            }\n        });\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Work Order",
  "enabled": 1,
  "modified": "2025-07-17 18:53:21.257172",
  "module": "erpnextkta",
  "name": "KTA Work Order Client Scripts",
  "script": "frappe.ui.form.on('Work Order', {\r\n    custom_etiket_bas: function(frm){\r\n        frappe.call({\r\n                    method: \"erpnextkta.api.print_kta_wo_labels\",\r\n                    args:{\r\n                        \"work_order\": frm.doc.name\r\n                    }\r\n        });\r\n    },\r\n    refresh: function(frm) {\r\n       if (frm.doc.custom_kesim_formu_link) {\r\n            frm.add_custom_button('Kesim Formunu Aç', function () {\r\n                window.open(frm.doc.custom_kesim_formu_link, '_blank');\r\n            }, 'View');  // View altına geldi\r\n        }\r\n        // Sadece taslak durumda ve kapatılmamış belgelerde çalıştır\r\n        if (\r\n            frm.doc.docstatus === 0 &&\r\n            frm.doc.production_item &&\r\n            !frm.doc.__islocal &&\r\n            frm.doc.status !== \"Closed\"\r\n        ) {\r\n            set_item_group(frm);\r\n        }\r\n    },\r\n    production_item: function(frm) {\r\n        // Ürün değiştiğinde sadece taslak ve kapatılmamış belgelerde çalıştır\r\n        if (frm.doc.docstatus === 0 && frm.doc.status !== \"Closed\") {\r\n            set_item_group(frm);\r\n        }\r\n    },\r\n    onload: function(frm) {\r\n        frm.set_df_property('custom_ürün_grubu', 'read_only', 1);\r\n    }\r\n});\r\n\r\n// Yardımcı fonksiyon\r\nfunction set_item_group(frm) {\r\n    if (frm.doc.production_item) {\r\n        frappe.db.get_value(\"Item\", frm.doc.production_item, \"item_group\")\r\n            .then(r => {\r\n                if (r.message && r.message.item_group) {\r\n                    frm.set_value(\"custom_ürün_grubu\", r.message.item_group);\r\n                }\r\n            });\r\n    }\r\n}\r\n",
  "view": "Form"
 }
]