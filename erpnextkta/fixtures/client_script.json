[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quality Feedback",
  "enabled": 1,
  "modified": "2025-01-06 23:12:47.353691",
  "module": "erpnextkta",
  "name": "KTA Degerlendirme Toplami",
  "script": "frappe.ui.form.on('Quality Feedback', {\n\tvalidate(frm) {\n        // calculate points for parameters on the feedback\n        degerlendirme_toplam = 0;\n        $.each(frm.doc.parameters,  function(i,  d) {\n            // calculate total\n            degerlendirme_toplam += flt(d.rating);\n        });\n        frm.doc.degerlendirme_toplami = degerlendirme_toplam;\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Customer",
  "enabled": 1,
  "modified": "2025-01-09 17:41:35.114236",
  "module": "erpnextkta",
  "name": "KTA Müşteri Gelir Hesabı",
  "script": "frappe.ui.form.on('Customer', {\n\tsetup(frm) {\n\t\tfrm.set_query(\"customer_income_account\", \"accounts\", function (doc, cdt, cdn) {\n\t\t\tlet d = locals[cdt][cdn];\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\taccount_type: \"Income Account\",\n\t\t\t\t\troot_type: \"Income\",\n\t\t\t\t\tcompany: d.company,\n\t\t\t\t\tis_group: 0,\n\t\t\t\t},\n\t\t\t};\n\t\t});\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2025-01-11 06:09:25.924044",
  "module": "erpnextkta",
  "name": "KTA Müşteri Gelir Hesabı Ataması",
  "script": "frappe.ui.form.on('Sales Invoice', {\r\n    onload: function(frm) {\r\n        // Populate income account for all items when the form is loaded\r\n        frm.doc.items.forEach(function(item) {\r\n            if (item.item_code && frm.doc.company && frm.doc.customer) {\r\n                fetch_customer_income_account(frm, item);\r\n            }\r\n        });\r\n    },\r\n    refresh: function(frm) {\r\n        // Populate income account for all items when the form is refreshed\r\n        frm.doc.items.forEach(function(item) {\r\n            if (item.item_code && frm.doc.company && frm.doc.customer) {\r\n                fetch_customer_income_account(frm, item);\r\n            }\r\n        });\r\n    }\r\n});\r\n\r\nfrappe.ui.form.on('Sales Invoice Item', {\r\n    item_code: function(frm, cdt, cdn) {\r\n        let item = frappe.get_doc(cdt, cdn);\r\n        if (item.item_code && frm.doc.company && frm.doc.customer) {\r\n            frappe.call({\r\n                method: 'erpnextkta.api.get_customer_income_account', // Updated method path\r\n                args: {\r\n                    'customer': frm.doc.customer,\r\n                    'company': frm.doc.company\r\n                },\r\n                callback: function(r) {\r\n                    if (r.message) {\r\n                        frappe.model.set_value(cdt, cdn, 'income_account', r.message);\r\n                    } else {\r\n                        frappe.msgprint(__(\"No customer income account found for the selected customer and company.\"));\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n});\r\n\r\nfunction fetch_customer_income_account(frm, item) {\r\n    frappe.call({\r\n        method: 'erpnextkta.api.get_customer_income_account', // Updated method path\r\n        args: {\r\n            'customer': frm.doc.customer,\r\n            'company': frm.doc.company\r\n        },\r\n        callback: function(r) {\r\n            if (r.message) {\r\n                frappe.model.set_value(item.doctype, item.name, 'income_account', r.message);\r\n            } else {\r\n                frappe.msgprint(__(\"No customer income account found for the selected customer and company.\"));\r\n            }\r\n        }\r\n    });\r\n}",
  "view": "Form"
 }
]