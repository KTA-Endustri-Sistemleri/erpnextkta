[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2025-01-11 23:13:32.671903",
  "module": "erpnextkta",
  "name": "KTA Sales Order Customization",
  "script": "frappe.ui.form.on('Sales Order', {\n//\trefresh(frm) {\n\t\t// your code here\n//\t}\n\tmake_manufacture_request: function(frm){\n\t    if((frm.doc.docstatus === 1 && doc.status !== \"Closed\" && doc.status !== \"On Hold\")){\n\t        // Call the server-side method to create the Material Request\n            frappe.call({\n                method: 'erpnextkta.api.make_manufacture_request',\n                args: {\n                    source_name: frm.doc.name\n                },\n                callback: function(r) {\n                    if (r.message) {\n                        frappe.set_route('Form', 'Material Request', r.message);\n                    }\n                }\n\t        });\n\t    }\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quality Feedback",
  "enabled": 1,
  "modified": "2025-01-06 23:12:47.353691",
  "module": "erpnextkta",
  "name": "KTA Degerlendirme Toplami",
  "script": "frappe.ui.form.on('Quality Feedback', {\n\tvalidate(frm) {\n        // calculate points for parameters on the feedback\n        degerlendirme_toplam = 0;\n        $.each(frm.doc.parameters,  function(i,  d) {\n            // calculate total\n            degerlendirme_toplam += flt(d.rating);\n        });\n        frm.doc.degerlendirme_toplami = degerlendirme_toplam;\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Customer",
  "enabled": 1,
  "modified": "2025-01-09 17:41:35.114236",
  "module": "erpnextkta",
  "name": "KTA Müşteri Gelir Hesabı",
  "script": "frappe.ui.form.on('Customer', {\n\tsetup(frm) {\n\t\tfrm.set_query(\"customer_income_account\", \"accounts\", function (doc, cdt, cdn) {\n\t\t\tlet d = locals[cdt][cdn];\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\taccount_type: \"Income Account\",\n\t\t\t\t\troot_type: \"Income\",\n\t\t\t\t\tcompany: d.company,\n\t\t\t\t\tis_group: 0,\n\t\t\t\t},\n\t\t\t};\n\t\t});\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2025-01-11 06:09:25.924044",
  "module": "erpnextkta",
  "name": "KTA Müşteri Gelir Hesabı Ataması",
  "script": "frappe.ui.form.on('Sales Invoice', {\r\n    onload: function(frm) {\r\n        // Populate income account for all items when the form is loaded\r\n        frm.doc.items.forEach(function(item) {\r\n            if (item.item_code && frm.doc.company && frm.doc.customer) {\r\n                fetch_customer_income_account(frm, item);\r\n            }\r\n        });\r\n    },\r\n    refresh: function(frm) {\r\n        // Populate income account for all items when the form is refreshed\r\n        frm.doc.items.forEach(function(item) {\r\n            if (item.item_code && frm.doc.company && frm.doc.customer) {\r\n                fetch_customer_income_account(frm, item);\r\n            }\r\n        });\r\n    }\r\n});\r\n\r\nfrappe.ui.form.on('Sales Invoice Item', {\r\n    item_code: function(frm, cdt, cdn) {\r\n        let item = frappe.get_doc(cdt, cdn);\r\n        if (item.item_code && frm.doc.company && frm.doc.customer) {\r\n            frappe.call({\r\n                method: 'erpnextkta.api.get_customer_income_account', // Updated method path\r\n                args: {\r\n                    'customer': frm.doc.customer,\r\n                    'company': frm.doc.company\r\n                },\r\n                callback: function(r) {\r\n                    if (r.message) {\r\n                        frappe.model.set_value(cdt, cdn, 'income_account', r.message);\r\n                    } else {\r\n                        frappe.msgprint(__(\"No customer income account found for the selected customer and company.\"));\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n});\r\n\r\nfunction fetch_customer_income_account(frm, item) {\r\n    frappe.call({\r\n        method: 'erpnextkta.api.get_customer_income_account', // Updated method path\r\n        args: {\r\n            'customer': frm.doc.customer,\r\n            'company': frm.doc.company\r\n        },\r\n        callback: function(r) {\r\n            if (r.message) {\r\n                frappe.model.set_value(item.doctype, item.name, 'income_account', r.message);\r\n            } else {\r\n                frappe.msgprint(__(\"No customer income account found for the selected customer and company.\"));\r\n            }\r\n        }\r\n    });\r\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Job Card",
  "enabled": 1,
  "modified": "2025-01-23 01:46:54.882008",
  "module": "erpnextkta",
  "name": "KTA Job Card employee ignore_user_permissions",
  "script": "frappe.ui.form.on('Job Card', {\n    refresh: function(frm) {\n        // Set \"Ignore User Permissions\" for the field\n        frm.set_df_property('employee', 'ignore_user_permissions', 1);\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Kalite 8D Formu",
  "enabled": 1,
  "modified": "2025-01-23 02:07:31.420310",
  "module": "erpnextkta",
  "name": "KTA Kalite 8D Formu d1_takim_uyesi",
  "script": "frappe.ui.form.on('D1 Takim Uyeleri', {\n    refresh: function(frm) {\n        // Set \"Ignore User Permissions\" for the field in the child table\n        frm.set_df_property('d1_takim_uyesi', 'ignore_user_permissions', 1);\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Work Order",
  "enabled": 1,
  "modified": "2025-05-28 13:44:47.910100",
  "module": "erpnextkta",
  "name": "KTA Kesim Formu Butonu",
  "script": "frappe.ui.form.on('Work Order', {\n    refresh: function(frm) {\n        if (frm.doc.custom_kesim_formu_link) {\n            frm.add_custom_button('Kesim Formunu Aç', function () {\n                window.open(frm.doc.custom_kesim_formu_link, '_blank');\n            }, 'View');  // View altına geldi\n        }\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Project",
  "enabled": 1,
  "modified": "2025-05-28 13:45:11.599923",
  "module": "erpnextkta",
  "name": "KTA Proje Klasörü",
  "script": "frappe.ui.form.on('Project', {\n    refresh(frm) {\n        if (frm.doc.project_name) {\n            const folderName = encodeURIComponent(frm.doc.project_name);\n            const path = `/app/file?folder=Home/Projeler/${folderName}`;\n            \n            frm.add_custom_button(__('Proje Klasörü'), function () {\n                window.open(path, '_blank');\n            });\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item Price",
  "enabled": 1,
  "modified": "2025-05-28 13:45:34.251458",
  "module": "erpnextkta",
  "name": "KTA Ara Malzeme Grubu",
  "script": "frappe.ui.form.on(\"Item Price\", {\n    item_code: function(frm) {\n        if (frm.doc.item_code) {\n            frappe.call({\n                method: \"frappe.client.get_value\",\n                args: {\n                    doctype: \"Item\",\n                    filters: {\n                        name: frm.doc.item_code\n                    },\n                    fieldname: [\"custom_ara_malzeme_grubu\"]\n                },\n                callback: function(r) {\n                    if (r.message && r.message.custom_ara_malzeme_grubu) {\n                        frm.set_value(\"custom_ara_malzeme_kodu\", r.message.custom_ara_malzeme_grubu);\n                        console.log(\"Ara malzeme grubu güncellendi:\", r.message.custom_ara_malzeme_grubu);\n                    } else {\n                        frm.set_value(\"custom_ara_malzeme_kodu\", \"\");\n                        console.warn(\"Ürün bulundu ama 'custom_ara_malzeme_grubu' boş.\");\n                    }\n                }\n            });\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Work Order",
  "enabled": 1,
  "modified": "2025-05-28 13:45:53.648264",
  "module": "erpnextkta",
  "name": "KTA Work Order Material Group",
  "script": "frappe.ui.form.on('Work Order', {\n    refresh: function(frm) {\n        // Sadece taslak durumda ve kapatılmamış belgelerde çalıştır\n        if (\n            frm.doc.docstatus === 0 &&\n            frm.doc.production_item &&\n            !frm.doc.__islocal &&\n            frm.doc.status !== \"Closed\"\n        ) {\n            set_item_group(frm);\n        }\n    },\n    production_item: function(frm) {\n        // Ürün değiştiğinde sadece taslak ve kapatılmamış belgelerde çalıştır\n        if (frm.doc.docstatus === 0 && frm.doc.status !== \"Closed\") {\n            set_item_group(frm);\n        }\n    },\n    onload: function(frm) {\n        frm.set_df_property('custom_ürün_grubu', 'read_only', 1);\n    }\n});\n\n// Yardımcı fonksiyon\nfunction set_item_group(frm) {\n    if (frm.doc.production_item) {\n        frappe.db.get_value(\"Item\", frm.doc.production_item, \"item_group\")\n            .then(r => {\n                if (r.message && r.message.item_group) {\n                    frm.set_value(\"custom_ürün_grubu\", r.message.item_group);\n                }\n            });\n    }\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "KTA Depo Etiketleri",
  "enabled": 1,
  "modified": "2025-07-09 08:54:44.602618",
  "module": "erpnextkta",
  "name": "KTA Depo Etiketi Bas",
  "script": "frappe.ui.form.on('KTA Depo Etiketleri', {\n// refresh(frm) {\n    print_label_to_zebra_kta: function(frm){\n        frappe.call({\n                    method: \"erpnextkta.api.print_kta_pr_labels\",\n                    args:{\n                        \"label\": frm.doc.name\n                    },\n                    callback: function(r){\n                        frm.set_value(\"custom_print_status\", r.message);\n                    }\n                });\n    },\n    print_split_labels_to_zebra_kta: function(frm){\n        frappe.call({\n                    method: \"erpnextkta.api.print_split_kta_pr_labels\",\n                    args:{\n                        \"label\": frm.doc.name\n                    },\n                    callback: function(r){\n                        frm.set_value(\"custom_print_status\", r.message);\n                    }\n                });\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "KTA machine capability study",
  "enabled": 1,
  "modified": "2025-07-03 14:47:20.925055",
  "module": "erpnextkta",
  "name": "KTA Kalite CMK CM CPK",
  "script": "frappe.ui.form.on('KTA machine capability study', {\r\n    refresh: function(frm) {\r\n        calculateCapability(frm);\r\n    },\r\n    mean_value: function(frm) {\r\n        calculateCapability(frm);\r\n    },\r\n    standard_deviation: function(frm) {\r\n        calculateCapability(frm);\r\n    },\r\n    upper_limit: function(frm) {\r\n        calculateCapability(frm);\r\n    },\r\n    lower_limit: function(frm) {\r\n        calculateCapability(frm);\r\n    },\r\n    tepe_degerixq: function(frm) {  // Yeni alan için event\r\n        calculateCapability(frm);\r\n    },\r\n    dip_degerixq: function(frm) {    // Yeni alan için event\r\n        calculateCapability(frm);\r\n    }\r\n});\r\n\r\nfunction calculateCapability(frm) {\r\n    // Temel değerler\r\n    const mean = parseFloat(frm.doc.mean_value);\r\n    const std = parseFloat(frm.doc.standard_deviation);\r\n    const usl = parseFloat(frm.doc.upper_limit);\r\n    const lsl = parseFloat(frm.doc.lower_limit);\r\n    \r\n    // Yeni eklenen özel değerler\r\n    const tepe = parseFloat(frm.doc.tepe_degerixq);\r\n    const dip = parseFloat(frm.doc.dip_degerixq);\r\n\r\n    // Validasyonlar\r\n    if ([mean, std, usl, lsl, tepe, dip].some(isNaN)) {\r\n        clearResults(frm);\r\n        return;\r\n    }\r\n\r\n    if (std <= 0) {\r\n        frappe.msgprint(__('Standart sapma sıfırdan büyük olmalıdır'));\r\n        clearResults(frm);\r\n        return;\r\n    }\r\n\r\n    if (usl <= lsl) {\r\n        frappe.msgprint(__('Üst limit alt limitten büyük olmalıdır'));\r\n        clearResults(frm);\r\n        return;\r\n    }\r\n\r\n    // CM Hesaplaması (Orijinal formül)\r\n    const cm = (usl - lsl) / (6 * std);\r\n\r\n    // CMK Hesaplaması (Yeni özel değerlerle)\r\n    const cpu = (usl - tepe) / (3 * std);  // Üst limit için tepe değeri kullanılıyor\r\n    const cpl = (dip - lsl) / (3 * std);   // Alt limit için dip değeri kullanılıyor\r\n    const cmk = Math.min(cpu, cpl);\r\n\r\n    // CPK Hesaplaması (Orijinal mean ile)\r\n    const cpk_cpu = (usl - mean) / (3 * std);\r\n    const cpk_cpl = (mean - lsl) / (3 * std);\r\n    const cpk = Math.min(cpk_cpu, cpk_cpl);\r\n\r\n    // Sonuçları ata\r\n    frm.set_value('cm_value', cm);\r\n    frm.set_value('cmk_value', cmk);\r\n    frm.set_value('cpk_value', cpk);\r\n    \r\n    frm.refresh_fields();\r\n}\r\n\r\nfunction clearResults(frm) {\r\n    frm.set_value('cm_value', null);\r\n    frm.set_value('cmk_value', null);\r\n    frm.set_value('cpk_value', null);\r\n    frm.refresh_fields();\r\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Work Order",
  "enabled": 1,
  "modified": "2025-07-09 16:47:46.492990",
  "module": "erpnextkta",
  "name": "KTA Ürün Tanıtım Etiketi Bas",
  "script": "frappe.ui.form.on('Work Order', {\n\tcustom_etiket_bas: function(frm){\n        frappe.call({\n                    method: \"erpnextkta.api.print_kta_wo_labels\",\n                    args:{\n                        \"work_order\": frm.doc.name\n                    }\n                });\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Entry",
  "enabled": 1,
  "modified": "2025-07-11 16:29:16.305841",
  "module": "erpnextkta",
  "name": "KTA Hareketten Ürün Tanıtım Etiketi Bas",
  "script": "frappe.ui.form.on('Stock Entry', {\n\tcustom_etiket_bas: function(frm){\n        frappe.call({\n                    method: \"erpnextkta.api.print_kta_wo_labels_of_stock_entry\",\n                    args:{\n                        \"stock_entry\": frm.doc.name\n                    }\n                });\n    }\n});",
  "view": "Form"
 }
]